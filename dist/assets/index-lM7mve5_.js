(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))s(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&s(r)}).observe(document,{childList:!0,subtree:!0});function n(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function s(o){if(o.ep)return;o.ep=!0;const a=n(o);fetch(o.href,a)}})();const Bt="/",Mt=new URL(Bt,window.location.href),mt=new URL("data/kanji_g1_proto.json",Mt).toString(),pt=new URL("data/strokes/",Mt).toString(),$=new Map,Dt=16,rt=28,Xt=.45,qt=.15,Ut=.35,Vt=3,vt=.35,Et=1.2,Kt=32,v=document.getElementById("stars"),C=document.getElementById("mode"),Yt=document.getElementById("kanjiLabel"),q=document.getElementById("kanjiArea"),st=document.getElementById("strokeButtons"),K=document.getElementById("teacherToggle"),ot=document.getElementById("prevBtn"),at=document.getElementById("nextBtn"),Y=document.getElementById("error"),xt=document.getElementById("hint");function D(t){xt&&(xt.textContent=String(t??""))}function Q(){if(M){D("クリア！「つぎ」で次のもじへ");return}if(R){D("そのまま、なぞっていこう");return}const t=Math.max(0,(T==null?void 0:T[d])??0);if(t>=2){D("だいじょうぶ！ゆっくりでOK");return}else if(t===1){D("もういちど。ゆっくりでOK");return}const e=d+1,n="①②③④⑤⑥⑦⑧⑨⑩⑪⑫⑬⑭⑮⑯⑰⑱⑲⑳",s=e>=1&&e<=n.length?n[e-1]:String(e);D(`${s}のところから、なぞろう`)}const kt="kanjiTraceTeacherMode";let E=!1;function Nt(){document.documentElement.classList.toggle("teacher-mode",E),K&&K.setAttribute("aria-pressed",E?"true":"false"),C&&(C.textContent=E?"もくひょう：5もじ（先生）":"もくひょう：5もじ")}function zt(t,e=900){ft(t),setTimeout(()=>Rt(),e)}function tt(){E=!E,localStorage.setItem(kt,E?"1":"0"),Nt(),zt(E?"先生モード：ON":"先生モード：OFF")}let S=[],g=0;const et=5;function Pt(t=g){const e=Math.floor(t/et)*et,n=Math.min(e+et,S.length),s=n-e,o=t-e;return{start:e,end:n,len:s,pos:o}}let d=0,j=[],T=[],F=null,O=null,N=null,it=null;const Gt=650;let M=!1,R=!1,A=[],L=null,X=!1;const yt=520,Jt=520;Wt();async function Wt(){if(E=Te(),Nt(),C){C.addEventListener("dblclick",()=>tt());let t=null;C.addEventListener("pointerdown",()=>{t=setTimeout(()=>tt(),900)});const e=()=>{t&&clearTimeout(t),t=null};C.addEventListener("pointerup",e),C.addEventListener("pointercancel",e),C.addEventListener("pointerleave",e)}K&&K.addEventListener("click",()=>{tt()});try{S=await Zt()}catch(t){ft(`データ読み込み失敗: ${String((t==null?void 0:t.message)??t)}`),S=gt()}(!Array.isArray(S)||S.length===0)&&(ft("データなし"),S=gt()),ot.addEventListener("click",()=>ct(-1)),at.addEventListener("click",()=>ct(1)),z()}async function Zt(){const t=await fetch(mt,{cache:"no-store"});if(!t.ok)throw new Error(`HTTP ${t.status} (${mt})`);const e=await t.json();if(Array.isArray(e))return e.map(n=>{const s=n==null?void 0:n.id,o=(n==null?void 0:n.grade)??1,a=s?`g${o}/${s}.json`:null;return{...n,strokesRef:(n==null?void 0:n.strokesRef)??a}});throw new Error("JSON形式が想定と違います（配列でも items でもない）")}function gt(){return[{kanji:"木",strokesCount:4},{kanji:"山",strokesCount:3},{kanji:"川",strokesCount:3},{kanji:"口",strokesCount:3},{kanji:"人",strokesCount:2}]}function ct(t){g=Ht(g+t,0,S.length-1),d=0,j=[],z()}async function z(){Rt(),M=!1;const t=S[g],e=(t==null?void 0:t.kanji)??"?",n=Pt(g);ee(n.pos,n.len),Yt.textContent=`${e} (${n.pos+1}/${n.len})`,q.innerHTML='<div style="font-size:20px; opacity:.7; font-weight:700;">よみこみ中…</div>';const s=await Qt(t);if(!s||s.length===0){q.innerHTML=`<div style="font-size:96px; opacity:.35; font-weight:700;">${Ce(e)}</div>`,st.innerHTML="",ot.disabled=g===0,at.disabled=g===S.length-1;return}j=new Array(s.length).fill(!1),d=0,T=new Array(s.length).fill(0),lt(s.length),q.innerHTML="",F=he(s),q.appendChild(F),it=s,ht(),ie(F,s),ot.disabled=g===0,at.disabled=g===S.length-1,pe(F,s),jt(F)}async function Qt(t){if(!t)return null;const e=t.strokesRef;if(e){if(!$.has(e)){const o=new URL(e,pt).toString(),a=fetch(o,{cache:"no-store"}).then(r=>r.ok?r.json():null).then(r=>r?bt(r):null).catch(()=>null);$.set(e,a)}return await $.get(e)}const n=t.kanji;if(!n)return null;const s=`g1/${encodeURIComponent(n)}.json`;if(!$.has(s)){const o=new URL(s,pt).toString(),a=fetch(o,{cache:"no-store"}).then(r=>r.ok?r.json():null).then(r=>r?bt(r):null).catch(()=>null);$.set(s,a)}return await $.get(s)}function bt(t){if(!t||!Array.isArray(t.strokes))return null;const e=[];for(const n of t.strokes)n!=null&&n.path&&e.push(te(n.path));return e}function te(t){const e=String(t).trim().match(/[ML]|-?\d*\.?\d+/g);if(!e)return[];const n=[];let s=0;for(;s<e.length;){const o=e[s++];if(o==="M"||o==="L"){const a=Number(e[s++]),r=Number(e[s++]);Number.isFinite(a)&&Number.isFinite(r)&&n.push({x:a,y:r});continue}}return n}function ee(t,e){const s=e<=1?1:t/(e-1),o=Math.round(s*4)+1,a=[];for(let r=0;r<5;r++)a.push(r<o?"★":"☆");v.textContent=a.join(""),o===5&&At!==5&&It(),At=o}let At=0;function It(){v&&(v.classList.remove("starsSparkle"),v.offsetWidth,v.classList.add("starsSparkle"),ne(8))}function ne(t=8){if(!v)return;const e=v.getBoundingClientRect(),n=e.width/2,s=e.height/2;for(let o=0;o<t;o++){const a=document.createElement("span");a.className="star-spark";const r=Math.random()*Math.PI*2,i=10+Math.random()*18,l=Math.cos(r)*i,c=Math.sin(r)*i,u=n+(Math.random()*8-4),f=s+(Math.random()*6-3);a.style.left=`${u}px`,a.style.top=`${f}px`,a.style.setProperty("--dx",`${l}px`),a.style.setProperty("--dy",`${c}px`),v.appendChild(a),a.addEventListener("animationend",()=>a.remove(),{once:!0})}}function lt(t){st.innerHTML="";for(let e=0;e<t;e++){const n=document.createElement("button");n.type="button",n.className="stroke-btn",n.textContent=String(e+1),e===d&&n.classList.add("is-active"),j[e]&&n.classList.add("is-done"),n.disabled=!0,st.appendChild(n)}}let U=null;function re(){if(U)return U;const t=window.AudioContext||window.webkitAudioContext;return t?(U=new t,U):null}function G(t=660,e=.07,n="sine",s=.04){const o=re();if(!o)return;o.state==="suspended"&&o.resume().catch(()=>{});const a=o.currentTime,r=o.createOscillator(),i=o.createGain();r.type=n,r.frequency.setValueAtTime(t,a),i.gain.setValueAtTime(1e-4,a),i.gain.exponentialRampToValueAtTime(s,a+.01),i.gain.exponentialRampToValueAtTime(1e-4,a+e),r.connect(i),i.connect(o.destination),r.start(a),r.stop(a+e+.02)}function se(){G(784,.06,"sine",.05),G(988,.06,"sine",.04)}function oe(){navigator.vibrate&&navigator.vibrate(18)}function _t(t){const e="http://www.w3.org/2000/svg";let n=t.querySelector('[data-role="fx"]');return n||(n=document.createElementNS(e,"g"),n.dataset.role="fx",n.setAttribute("class","fx-layer"),t.appendChild(n),n)}function ae(t){const e="http://www.w3.org/2000/svg";let n=t.querySelector('[data-role="charLayer"]');return n||(n=document.createElementNS(e,"g"),n.dataset.role="charLayer",n.setAttribute("class","char-layer"),t.appendChild(n),n)}function Z(t){const e="http://www.w3.org/2000/svg";let n=t.querySelector('[data-role="char"]');if(n)return n;const s=ae(t);return n=document.createElementNS(e,"circle"),n.dataset.role="char",n.setAttribute("r","3.2"),n.setAttribute("cx","0"),n.setAttribute("cy","0"),n.setAttribute("class","char"),n.setAttribute("transform","translate(50 50)"),s.appendChild(n),n}const St=1.6;function J(t,e){const n=t==null?void 0:t[e];if(!n||n.length<2)return{x:50,y:50};let s=0;const o=[];for(let c=0;c<n.length-1;c++){const u=n[c],f=n[c+1],m=f.x-u.x,h=f.y-u.y,p=Math.hypot(m,h);o.push(p),s+=p}if(s<=1e-4)return{x:n[0].x,y:n[0].y};const a=e===t.length-1,r=s*(a?.5:.6);let i=0;for(let c=0;c<o.length;c++){const u=o[c];if(i+u>=r){const f=(r-i)/u,m=n[c],h=n[c+1];let p=m.x+(h.x-m.x)*f,I=m.y+(h.y-m.y)*f,y=h.x-m.x,w=h.y-m.y;const x=Math.hypot(y,w)||1;y/=x,w/=x;let b=-w,k=y;return k>0&&(b=-b,k=-k),p+=b*St,I+=k*St,{x:p,y:I}}i+=u}const l=n[n.length-1];return{x:l.x,y:l.y}}function $t(t,e){Z(t).setAttribute("transform",`translate(${e.x} ${e.y})`),t.dataset.charX=String(e.x),t.dataset.charY=String(e.y)}function Ft(t){const e=Number(t.dataset.charX||"50"),n=Number(t.dataset.charY||"50");return{x:e,y:n}}function ie(t,e){const n=J(e,0);$t(t,n)}function ce(t,e){const n=Z(t),s=Ft(t),o={x:(s.x+e.x)/2,y:(s.y+e.y)/2-10};n.getAnimations().forEach(r=>r.cancel());const a=(r,i=1,l=1)=>({transform:`translate(${r.x}px, ${r.y}px) scale(${i}, ${l})`});n.animate([a(s,1,1),a(o,1.08,1.08),a(e,1,1),a(e,1.12,.88),a(e,1,1)],{duration:520,easing:"ease-out",fill:"forwards"}),setTimeout(()=>$t(t,e),540)}function le(t){const e=Z(t),n=Ft(t),s={x:n.x,y:n.y+14};e.getAnimations().forEach(a=>a.cancel());const o=(a,r=1,i=1)=>({transform:`translate(${a.x}px, ${a.y}px) scale(${r}, ${i})`});e.animate([o(n,1,1),o(s,.92,1.1),o(n,1,1),o(n,1.12,.88),o(n,1,1)],{duration:520,easing:"ease-out",fill:"forwards"})}function wt(t,e,n=10){const s="http://www.w3.org/2000/svg",o=_t(t),{x:a,y:r}=e||{x:50,y:50};for(let i=0;i<n;i++){const l=document.createElementNS(s,"circle");l.setAttribute("cx",a.toFixed(2)),l.setAttribute("cy",r.toFixed(2)),l.setAttribute("r","1.2"),l.setAttribute("class","fx-spark"),o.appendChild(l);const c=Math.random()*Math.PI*2,u=6+Math.random()*10,f=Math.cos(c)*u,m=Math.sin(c)*u,h=l.animate([{transform:"translate(0px, 0px)",opacity:.95},{transform:`translate(${f}px, ${m}px)`,opacity:0}],{duration:280+Math.random()*120,easing:"ease-out",fill:"forwards"});h.onfinish=()=>l.remove()}}function ue(t){t&&(t.classList.add("failFlash"),setTimeout(()=>t.classList.remove("failFlash"),160))}function de(t){const e="http://www.w3.org/2000/svg",n=_t(t),s=document.createElementNS(e,"g");s.setAttribute("class","hanamaru"),s.setAttribute("transform","translate(50 50) scale(0)"),n.appendChild(s);const o=document.createElementNS(e,"circle");o.setAttribute("cx","0"),o.setAttribute("cy","0"),o.setAttribute("r","26"),o.setAttribute("fill","none"),o.setAttribute("stroke","#ff7a00"),o.setAttribute("stroke-width","6"),o.setAttribute("stroke-linecap","round"),s.appendChild(o);const a=document.createElementNS(e,"text");a.setAttribute("x","0"),a.setAttribute("y","10"),a.setAttribute("text-anchor","middle"),a.setAttribute("font-size","18"),a.setAttribute("font-weight","700"),a.setAttribute("fill","#ff7a00"),a.textContent="はなまる！",s.appendChild(a),s.animate([{transform:"translate(50px,50px) scale(0)",opacity:0},{transform:"translate(50px,50px) scale(1.15)",opacity:1},{transform:"translate(50px,50px) scale(1)",opacity:1}],{duration:420,easing:"ease-out",fill:"forwards"}),G(880,.08,"sine",.06),setTimeout(()=>G(1175,.1,"sine",.05),90),It(),setTimeout(()=>{s.remove()},1200)}let V=null;function ut(){V&&(V.remove(),V=null)}function fe({onReplay:t,onNextSet:e}){ut();const n=document.createElement("div");n.className="final-overlay",n.innerHTML=`
    <div class="final-card" role="dialog" aria-label="クリアメニュー">
      <div class="final-title">できた！</div>
      <div class="final-actions">
        <button type="button" class="btn" data-action="replay">もういちど</button>
        <button type="button" class="btn primary" data-action="next">つぎの5もじ</button>
      </div>
    </div>
  `,n.addEventListener("click",s=>{const o=s.target.closest("button");if(!o)return;const a=o.dataset.action;a==="replay"&&(t==null||t()),a==="next"&&(e==null||e())}),document.body.appendChild(n),V=n}function he(t){const e="http://www.w3.org/2000/svg",n=document.createElementNS(e,"svg");n.setAttribute("viewBox","0 0 100 100"),n.setAttribute("class","kanjiSvg"),n.setAttribute("aria-label","漢字ストローク");const s=document.createElementNS(e,"g");s.dataset.role="bgLayer";const o=document.createElementNS(e,"g");o.dataset.role="roadLayer";const a=document.createElementNS(e,"g");a.dataset.role="charLayer",a.setAttribute("class","char-layer");const r=document.createElementNS(e,"g");r.dataset.role="strokeLayer";const i=document.createElementNS(e,"g");i.dataset.role="hintLayer",n.appendChild(s),n.appendChild(o),n.appendChild(a),n.appendChild(r),n.appendChild(i),t.forEach((y,w)=>{const x=document.createElementNS(e,"path");x.setAttribute("d",H(y)),x.dataset.strokeIndex=String(w),x.setAttribute("class","stroke-shadow"),o.appendChild(x);const b=document.createElementNS(e,"path");b.setAttribute("d",H(y)),b.dataset.strokeIndex=String(w),b.setAttribute("class","stroke-base"),r.appendChild(b)});const l=document.createElementNS(e,"g");l.dataset.role="strokeHint",l.setAttribute("pointer-events","none");const c=document.createElementNS(e,"circle");c.dataset.role="strokeHintDot",c.setAttribute("r","14"),c.setAttribute("class","stroke-hint-dot");const u=document.createElementNS(e,"text");u.dataset.role="strokeHintNum",u.setAttribute("class","stroke-hint-num"),u.setAttribute("text-anchor","middle"),u.setAttribute("dominant-baseline","middle"),l.appendChild(c),l.appendChild(u),i.appendChild(l),O=c,N=u;const f=document.createElementNS(e,"g");f.setAttribute("class","teacher-overlay"),f.dataset.role="teacherOverlay",t.forEach((y,w)=>{const x=y==null?void 0:y[0];if(!x)return;const{x:b,y:k}=x,B=document.createElementNS(e,"circle");B.setAttribute("class","teacher-start-dot"),B.setAttribute("cx",String(b)),B.setAttribute("cy",String(k)),B.setAttribute("r","3.2"),f.appendChild(B);const _=document.createElementNS(e,"text");_.setAttribute("class","teacher-start-num"),_.setAttribute("x",String(b)),_.setAttribute("y",String(k+2.4)),_.setAttribute("text-anchor","middle"),_.textContent=String(w+1),f.appendChild(_)}),i.appendChild(f);const m=document.createElementNS(e,"path");m.setAttribute("class","stroke-active"),m.setAttribute("d",H(t[0])),m.dataset.role="active",r.appendChild(m),t.forEach((y,w)=>{const x=document.createElementNS(e,"path");x.setAttribute("d",H(y)),x.dataset.strokeIndex=String(w),x.setAttribute("class","stroke-hit"),r.appendChild(x)}),L=document.createElementNS(e,"path"),L.setAttribute("class","trace-line"),L.setAttribute("d",""),L.dataset.role="trace",r.appendChild(L);const h=document.createElementNS(e,"circle");h.dataset.role="char",h.setAttribute("class","char"),h.setAttribute("r","3.2"),h.setAttribute("cx","0"),h.setAttribute("cy","0");const p=J(t,0);h.setAttribute("transform",`translate(${p.x} ${p.y})`),n.dataset.charX=String(p.x),n.dataset.charY=String(p.y),a.appendChild(h);const I=document.createElementNS(e,"g");return I.dataset.role="fx",I.setAttribute("class","fx-layer"),r.appendChild(I),n}function ht(){if(!F||!O||!N||!it)return;const t=it[d];if(!t||!t.length){O.style.display="none",N.style.display="none";return}const e=t[0];O.style.display="",N.style.display="",O.setAttribute("cx",String(e.x)),O.setAttribute("cy",String(e.y)),N.setAttribute("x",String(e.x)),N.setAttribute("y",String(e.y)),N.textContent=String(d+1)}function me(t,e){const n=t.querySelector(`path.stroke-shadow[data-stroke-index="${e}"]`);n&&(n.classList.add("goal"),setTimeout(()=>n.classList.remove("goal"),700))}function Lt(t){X=!0,setTimeout(()=>{X=!1},t)}function pe(t,e){R=!1,A=[],L&&L.setAttribute("d",""),Z(t);const n=r=>{if(M||X||r.button!=null&&r.button!==0)return;const i=xe(r),l=Ct(t,r.clientX,r.clientY),c=e[d];if(!c||c.length<2)return;const u=c[0],f=c[c.length-1];if(!(Math.min(P(l,u),P(l,f))>rt)){if(i!=null){if(i!==d)return}else if(dt(l,e[d])>rt)return;R=!0,Q(),A=[l],nt(A);try{t.setPointerCapture(r.pointerId)}catch{}r.preventDefault()}},s=r=>{if(!R||X)return;const i=Ct(t,r.clientX,r.clientY);A.push(i),nt(A),r.preventDefault()},o=r=>{if(!R||X)return;R=!1;try{t.releasePointerCapture(r.pointerId)}catch{}const i=be(A,e[d]),l=A.length?A[A.length-1]:null;if(A=[],nt(A),i){j[d]=!0,T[d]=0,d++,ht(),d===e.length&&me(t,e.length-1);const c=d<e.length?J(e,d):J(e,e.length-1);if(Lt(yt),ce(t,c),Tt(t,e),lt(e.length),Q(),jt(t),wt(t,l||a(e[Math.max(0,d-1)])),se(),setTimeout(()=>{!t||!t.isConnected||wt(t,c,6)},Math.max(0,yt-80)),d>=e.length){M=!0,d=e.length-1,Tt(t,e),lt(e.length),Q();const u=Pt(g);u.pos<u.len-1?setTimeout(()=>{M&&ct(1)},Gt):(de(t),setTimeout(()=>{M&&fe({onReplay:()=>{ut(),g=u.start,M=!1,z()},onNextSet:()=>{ut(),g=u.end>=S.length?0:u.end,M=!1,z()}})},900))}}else T[d]=(T[d]??0)+1,Lt(Jt),Me(t),ue(t),oe(),le(t);r.preventDefault()};function a(r){if(!r||r.length===0)return{x:50,y:50};let i=0,l=0;for(const c of r)i+=c.x,l+=c.y;return{x:i/r.length,y:l/r.length}}t.addEventListener("pointerdown",n,{passive:!1}),t.addEventListener("pointermove",s,{passive:!1}),t.addEventListener("pointerup",o,{passive:!1}),t.addEventListener("pointercancel",o,{passive:!1})}function Tt(t,e){Array.from(t.querySelectorAll("path.stroke-base")).forEach(r=>{const i=Number(r.dataset.strokeIndex);Number.isFinite(i)&&j[i]?r.classList.add("done"):r.classList.remove("done")}),Array.from(t.querySelectorAll("path.stroke-shadow")).forEach(r=>{const i=Number(r.dataset.strokeIndex);if(!Number.isFinite(i))return;const l=!!j[i],c=r.classList.contains("on");l?(r.classList.add("on"),c||(r.classList.remove("pop"),r.getBBox(),r.classList.add("pop"),setTimeout(()=>r.classList.remove("pop"),320))):(r.classList.remove("on"),r.classList.remove("pop"))});const o=t.querySelector('path[data-role="active"]');if(!o)return;const a=Ht(d,0,e.length-1);o.setAttribute("d",H(e[a])),ht()}function xe(t){var o;const e=t.target;if(!e||!(e instanceof SVGPathElement)||!e.classList.contains("stroke-hit"))return null;const n=(o=e.dataset)==null?void 0:o.strokeIndex;if(n==null)return null;const s=Number(n);return Number.isFinite(s)?s:null}function nt(t){if(L){if(!t||t.length===0){L.setAttribute("d","");return}L.setAttribute("d",H(t))}}function ye(t){return Math.max(0,Math.min(1,t))}function ge(t){const s=ye((t-12)/48),o=Dt+(1-s)*4,a=o*1.15,r=Xt+s*.08,i=qt+s*.07,l=Ut+s*.15,c=rt-s*6;return{tol:o,coverTol:a,minHit:r,minDraw:i,minCover:l,startTol:c}}function be(t,e){if(!Array.isArray(t)||t.length<Vt)return!1;const n=Se(t,Et,vt);if(n.length<2)return!1;const s=n[0],o=e[0],a=W(e);if(a<=0)return!1;const r=ge(a);if(P(s,o)>r.startTol||W(n)<a*r.minDraw)return!1;const l=Math.max(0,Math.min(3,(T==null?void 0:T[d])??0));if(l>0){const p=l;r.tol+=2*p,r.coverTol=r.tol*1.15,r.minHit=Math.max(.3,r.minHit-.04*p),r.minCover=Math.max(.2,r.minCover-.05*p),r.startTol+=2*p}let c=0;for(const p of n)dt(p,e)<=r.tol&&c++;const u=c/n.length,f=Le(e,Kt);let m=0;for(const p of f)dt(p,n)<=r.coverTol&&m++;const h=m/f.length;return u>=r.minHit&&h>=r.minCover}function Ct(t,e,n){const s=t.createSVGPoint();s.x=e,s.y=n;const o=t.getScreenCTM();if(!o)return{x:0,y:0};const a=o.inverse(),r=s.matrixTransform(a);return{x:r.x,y:r.y}}function H(t){if(!t||t.length===0)return"";const[e,...n]=t;return`M ${e.x.toFixed(2)} ${e.y.toFixed(2)} `+n.map(s=>`L ${s.x.toFixed(2)} ${s.y.toFixed(2)}`).join(" ")}function W(t){let e=0;for(let n=1;n<t.length;n++)e+=P(t[n-1],t[n]);return e}function P(t,e){const n=t.x-e.x,s=t.y-e.y;return Math.hypot(n,s)}function dt(t,e){let n=1/0;for(let s=1;s<e.length;s++)n=Math.min(n,Ae(t,e[s-1],e[s]));return n}function Ae(t,e,n){const s=n.x-e.x,o=n.y-e.y,a=t.x-e.x,r=t.y-e.y,i=s*a+o*r;if(i<=0)return Math.hypot(t.x-e.x,t.y-e.y);const l=s*s+o*o;if(l<=i)return Math.hypot(t.x-n.x,t.y-n.y);const c=i/l,u=e.x+c*s,f=e.y+c*o;return Math.hypot(t.x-u,t.y-f)}function Se(t,e=Et,n=vt){if(!Array.isArray(t)||t.length===0)return[];const s=[t[0]];for(let o=1;o<t.length;o++){const a=s[s.length-1],r=t[o];P(a,r)>=n&&s.push(r)}return s.length<2?s:we(s,e)}function we(t,e){const n=W(t);if(n<=0)return t.slice();const s=[];for(let r=0;r<=n;r+=e)s.push(Ot(t,r));const o=t[t.length-1],a=s[s.length-1];return(!a||P(a,o)>.01)&&s.push({x:o.x,y:o.y}),s}function Ot(t,e){if(t.length===1)return{x:t[0].x,y:t[0].y};let n=0;for(let o=1;o<t.length;o++){const a=t[o-1],r=t[o],i=P(a,r);if(n+i>=e){const l=i===0?0:(e-n)/i;return{x:a.x+(r.x-a.x)*l,y:a.y+(r.y-a.y)*l}}n+=i}const s=t[t.length-1];return{x:s.x,y:s.y}}function Le(t,e){const n=W(t);if(n<=0)return t.slice(0,1);const s=[];for(let o=0;o<e;o++){const a=n*o/(e-1);s.push(Ot(t,a))}return s}function ft(t){Y&&(Y.textContent=t)}function Rt(){Y&&(Y.textContent="")}function Ht(t,e,n){return Math.max(e,Math.min(n,t))}function Te(){const t=new URLSearchParams(location.search).get("teacher");if(t==="1"||t==="true")return!0;if(t==="0"||t==="false")return!1;try{return localStorage.getItem(kt)==="1"}catch{return!1}}function Ce(t){return String(t).replace(/[&<>"']/g,e=>({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"})[e])}function jt(t){t&&(t.classList.remove("tracePulse"),t.offsetWidth,t.classList.add("tracePulse"))}function Me(t){t&&t.animate([{transform:"translateX(0)"},{transform:"translateX(-3px)"},{transform:"translateX(3px)"},{transform:"translateX(-2px)"},{transform:"translateX(2px)"},{transform:"translateX(0)"}],{duration:180,easing:"ease-out"})}
